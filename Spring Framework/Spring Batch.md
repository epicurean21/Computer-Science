# Spring Batch

![SpringBatch](./img/SpringBatch/SpringBatch.png)



### Spring Batch란 무엇인가

배치 프로세싱 (Batch Processing)은 **일괄처리**라는 뜻을 가지고 있다. 일괄처리의 의미는 **일련의 작업을 정해진 로직**으로 수행하는 것이라고 할 수 있다.

Spring Batch는 로깅/추적, 트랜잭션 관리, 작업 처리 통계, 작업 재시작, 건너뛰기, 리소스 관리 등 대용량 레코드 처리에 필수적인 기능을 제공한다. 또한 최적화 및 파티셔닝 기술을 통해 대용량 및 고성능 배치 작업을 가능하게 하는 고급 기술 서비스 및 기능을 제공한다.



이러한 일괄처리가 언제 필요할까?

> 1. 대용량의 비즈니스 데이터를 복잡한 작업으로 처리해야하는 경우
> 2. 특정한 시점에 스케쥴러를 통해 자동화된 작업이 필요한 경우 (ex. 푸시알림, 월 별 리포트)
> 3. 대용량 데이터의 포맷을 변경, 유효성 검사 등의 작업을 트랜잭션 안에서 처리 후 기록해야하는 경우



만약 Spring Batch에서 배치가 실패하여 작업을 재시작한다면?

- 처음부터가 아닌 **실패한 지점부터** 실행을 하게 된다.
- 또한, 중복 실행을 막기 위해 **성공한 이력이 있는 Batch는** <u>동일한 Parameter로 실행 시 Exception이 발생된다</u>



### Spring Batch vs. Quartz \ Scheduler

우선, Spring Batch는 Scheduler가 아니다 !

Spring Batch에서는 <u>Batch Job</u>을 관리하지만 그 Job을 구동/실행 시키는 기능이 존재하지 않는다.

Spring 에서 Batch Job을 실행시키기 위해서는 Quartz, Scheduler, Jenkins 등, 전용 Scheduler 를 사용해야 한다.



### 왜 Spring Batch를 batch 처리에 쓸까 ?

- 대용량 데이터 처리에 최적화 되어 고성능을 발휘한다.
- 효과적인 로깅, 통계 처리, 트랜잭션 관리 등 재사용 가능한 필수 기능을 지원한다.
- 수동으로 처리하지 않도록 자동화되어 있다.
- 예외사항과 비정상 동작에 대한 방어 기능이 있다.
- 스프링 부트 배치의 반복되는 작업 프로세스를 이해하면 비즈니스 로직에 집중 할 수 있다.



### Spring Batch 사용 <u>주의사항</u>

- 가능하면 **단순화해서** 복잡한 구조/로직을 피해야 한다.
- 배치 처리시 System I/O 사용을 최소화 해야한다.
  - 잦은 I/O 로 인한 데이터베이스 커넥션과 네트워크 비용이 커지면 성능에 영향을 줄 수 있다.
  - 따라서, 가능하면 **한 번에 데이터를 조회해서 메모리에 저장하고 처리한 다음, 그 결과를 또 한 번에 DB에 저장하는것이 좋다.**
- 일반적으로 같은 서비스에 사용되는 웹, API, 배치, 기타 프로젝트들은 서로 영향을 준다. 따라서 배치 처리가 진행되는 동안 다른 프로젝트 요소에 영향을 주는 경우가 없는지 주의를 기울여야한다.
- 스프링 부트 배치는 스케쥴러를 제공하지 않는다. 
  **배치 처리 기능**만 제공하며 스케줄링 기능은 스프링에서 제공하는 쿼츠 프레임워크(Quartz Framework)를 이용해야 한다. 



